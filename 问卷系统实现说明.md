# 动态问卷系统实现说明（方案B版）

## ✅ 已完成的工作

### 1. **创建问卷配置文件** (`static/questionnaire_config.js`)

根据《文献综述_因变量量表推荐.md》**方案B（增强纵向测量）**，实现了四个任务的全部问卷配置：

#### **任务1 - 关系建立后（24题 + IOS视觉量表）**
- ✅ 心智感知 (4题，5点Likert) - **精简版，保留核心**
- ✅ 关系亲密度 IOS视觉量表 (1题)
- ✅ 关系亲密度补充 (4题，7点Likert)
- ✅ 信任 (7题：认知信任4题 + 情感信任3题，7点Likert)
- ✅ 满意度 (4题，7点Likert)

**修改说明**：心智感知从6题精简到4题（Agency维度2题 + Experience维度2题）

---

#### **任务2 - 记忆触发后（22题 + IOS视觉量表）** ⭐
- ✅ 操纵检验 (5题，7点Likert) - **关键测量，首次验证**
- ✅ 感知理解度 (4题，7点Likert)
- ✅ 关系亲密度 IOS视觉量表 (1题)
- ✅ 关系亲密度补充 (4题，7点Likert)
- ✅ 自我披露 (5题：深度3题 + 诚实2题，7点Likert)
- ✅ 满意度 (4题，7点Likert)

---

#### **任务3 - 深度任务后（27题）**
- ✅ 操纵检验 (5题，7点Likert)
- ✅ 感知智能 (3题，5点Likert)
- ✅ 信任 (7题，7点Likert)
- ✅ 社会临场感 (4题，7点Likert)
- ✅ 持续使用意愿 (4题，7点Likert)
- ✅ 满意度 (4题，7点Likert)

---

#### **任务4 - 告别后（24题 + IOS + 1开放题）** ⭐ 方案B重点调整
- ✅ 操纵检验 (5题，7点Likert) - **最终验证**
- ✅ 关系亲密度 IOS视觉量表 (1题)
- ✅ 关系亲密度补充 (4题，7点Likert)
- ✅ **心智感知 (4题，5点Likert)** - **新增！纵向测量**
- ✅ **信任 (7题，7点Likert)** - **新增！完善纵向追踪**
- ✅ 满意度 (4题，7点Likert)
- ✅ 隐私担忧 (5题，7点Likert) - **精简版，删除"意识"维度**
- ✅ 开放性问题 (1题，文本输入) - **精简版，整合为综合问题**

**方案B重大调整**：
- ❌ **删除**：恐怖谷效应（5题）- 文献显示在纯文本AI对话中不显著
- ✅ **新增**：心智感知（4题）- 实现T1→T4纵向对比
- ✅ **新增**：信任（7题）- 实现T1→T3→T4完整追踪
- 📉 **精简**：隐私担忧 7题→5题，开放题 2题→1题

---

## 🎯 方案B的核心优势：增强纵向测量

### **纵向测量能力对比**

| 维度 | 原方案 | **方案B** | 提升 |
|------|--------|----------|------|
| 操纵检验 | T2/T3/T4（3点）✅ | T2/T3/T4（3点）✅ | 保持 |
| 关系亲密度 | T1/T2/T4（3点）✅ | T1/T2/T4（3点）✅ | 保持 |
| 满意度 | T1/T2/T3/T4（4点）✅ | T1/T2/T3/T4（4点）✅ | 保持 |
| **心智感知** | T1（1点）❌ | **T1/T4（2点）✅** | **+100%** ⭐ |
| **信任** | T1/T3（2点）△ | **T1/T3/T4（3点）✅** | **+50%** ⭐ |

### **可以回答的新研究问题**

**RQ1: 记忆能力如何影响心智感知的发展？**
```
假设：L4组（混合记忆）的心智感知从T1到T4提升最显著
分析：混合方差分析 Mixed ANOVA
      DV: 心智感知总分
      IV1(组间): 记忆水平 (L1/L2/L3/L4)
      IV2(组内): 时间 (T1/T4)
```

**RQ2: 信任的建立轨迹如何因记忆水平而异？**
```
假设：L4组信任增长最快，L1组停滞或下降
分析：增长曲线模型 Growth Curve Modeling
      测量点: T1(基线) → T3(中期) → T4(终点)
```

---

## 📊 完整题数统计

| 任务 | 题数 | 预估时间 | 纵向变量 |
|------|------|---------|---------|
| **任务1** | 24题+IOS | 5分钟 | 心智感知、亲密度、信任、满意度 (T1基线) |
| **任务2** | 22题+IOS | 4.5分钟 | 操纵检验⭐、亲密度、满意度 (T2追踪) |
| **任务3** | 27题 | 5.5分钟 | 操纵检验、信任、满意度 (T3追踪) |
| **任务4** | 24题+IOS+1开放 | 5分钟 | 操纵检验、亲密度、心智感知、信任、满意度 (T4终点) |
| **总计** | **97题** | **20分钟** | 5个核心纵向变量 |

**问卷负担评估**：✅ 优秀
- 单任务 < 6分钟（符合文献建议）
- 总时长 20分钟（4次×5分钟）
- 每任务 < 30题（避免疲劳效应）

---

## 📊 数据结构

### **任务2数据示例**（含操纵检验）

```json
{
  "task_id": 2,
  "timestamp": "2026-02-03T12:34:56Z",
  "responses": {
    "manipulation_check": {
      "q1": 7,
      "q2": 6,
      "q3": 5,
      "q4": 6,
      "q5": 7
    },
    "perceived_understanding": {
      "q1": 6,
      "q2": 5,
      "q3": 6,
      "q4": 7
    },
    "ios_closeness": {
      "ios_score": 5
    },
    "closeness": {
      "q1": 6,
      "q2": 5,
      "q3": 6,
      "q4": 5
    },
    "self_disclosure": {
      "q1": 4,
      "q2": 3,
      "q3": 5,
      "q4": 7,
      "q5": 6
    },
    "satisfaction": {
      "q1": 7,
      "q2": 6,
      "q3": 7,
      "q4": 6
    }
  }
}
```

### **任务4数据示例**（方案B新增内容）

```json
{
  "task_id": 4,
  "timestamp": "2026-02-03T18:45:00Z",
  "responses": {
    "manipulation_check": { "q1": 7, "q2": 6, "q3": 7, "q4": 6, "q5": 7 },
    "ios_closeness": { "ios_score": 6 },
    "closeness": { "q1": 6, "q2": 5, "q3": 6, "q4": 6 },
    "mind_perception": {
      "q1": 4,
      "q2": 4,
      "q3": 5,
      "q4": 4
    },
    "trust": {
      "q1": 7,
      "q2": 6,
      "q3": 6,
      "q4": 7,
      "q5": 6,
      "q6": 7,
      "q7": 6
    },
    "satisfaction": { "q1": 7, "q2": 6, "q3": 7, "q4": 7 },
    "privacy_concern": {
      "q1": 3,
      "q2": 4,
      "q3": 3,
      "q4": 4,
      "q5": 3
    },
    "open_ended": {
      "q1": "整体体验非常好，AI能够记住我之前说的内容，让对话更自然..."
    }
  }
}
```

---

## 🎨 特殊组件说明

### 1. **IOS视觉量表**

实现了Aron et al. (1992)的Inclusion of Other in Self量表：

```
○○  ○ ○  ◐○  ◑◐  ●◐  ●◑  ●●
1    2    3    4    5    6    7
```

**实现细节**：
- 7个选项，从"完全分离"到"高度重叠"
- 渐进式圆圈大小（30px → 65px）
- SVG实现，圆圈重叠效果
- 点击圆圈改变颜色（灰色→蓝色）
- 默认选中中间值（4分）

**代码片段**：
```javascript
renderIOSScale(section) {
    section.options.forEach(opt => {
        const size = 30 + opt.value * 5; // 渐进增大
        // SVG圆圈 + 重叠效果
    });
}
```

---

### 2. **操纵检验高亮** ⭐

任务2/3/4的操纵检验section会：
- 使用黄色双边框（`border-yellow-400 border-2`）
- CSS脉冲动画提示重要性
- 标题后带⭐标记
- `important: true` 配置触发

**视觉效果**：
```css
.border-yellow-400 {
    animation: pulse-border 2s ease-in-out infinite;
}

@keyframes pulse-border {
    0%, 100% { border-color: #FBBF24; }
    50% { border-color: #F59E0B; }
}
```

---

### 3. **语义差异量表**（任务4已删除）

~~用于测量恐怖谷效应（Ho & MacDorman, 2017）~~

**方案B说明**：恐怖谷效应量表已删除
- 原因：文献显示该效应在纯文本AI对话中不显著
- 替代：通过信任和心智感知间接测量用户舒适度

---

## 🧪 测试指南

### 1. **启动服务器**

```bash
cd D:\LLM\memory\ai_memory_experiment
python app.py
```

### 2. **访问系统**

浏览器打开：`http://localhost:8000`

---

### 3. **测试流程**

#### **测试任务1问卷（24题+IOS）** - 方案B修改

1. 注册/登录用户
2. 开始任务1，进行对话
3. 点击"完成任务并填写问卷"
4. ✅ 检查心智感知：**应为4题**（不是6题）
   - Q1: 这个AI似乎有它自己的意图（施动性）
   - Q2: 这个AI能够自主思考（施动性）
   - Q3: 这个AI能够体验情感（体验性）
   - Q4: 这个AI有意识（体验性）
5. ✅ 检查IOS视觉量表：7个渐进式圆圈
6. ✅ 检查信任：7题（标注认知/情感）

---

#### **测试任务2问卷（22题+IOS）** ⭐ 重点

1. 完成任务2对话
2. 查看问卷
3. ✅ 检查操纵检验：
   - 黄色双边框高亮
   - 脉冲动画
   - 5题记忆感知问题
   - 标题带⭐标记
4. ✅ 检查其他维度完整性

---

#### **测试任务3问卷（27题）**

1. ✅ 检查"社会临场感"（4题）
2. ✅ 检查"持续使用意愿"（4题）
3. ✅ 验证操纵检验持续测量

---

#### **测试任务4问卷（24题+IOS+1开放题）** ⭐ 方案B重点

**新增内容验证**：
1. ✅ **心智感知**（4题，与任务1完全相同）
   - 检查题目顺序和文本一致性
   - 验证5点Likert量表
2. ✅ **信任**（7题，与任务1/3相同）
   - 检查认知信任4题 + 情感信任3题
   - 验证7点Likert量表

**精简内容验证**：
3. ✅ 隐私担忧：**应为5题**（不是7题）
   - 收集担忧3题 + 控制担忧2题
   - 无"意识"维度
4. ✅ 开放题：**应为1题**（不是2题）
   - 综合性问题
   - 多行文本输入框

**删除内容验证**：
5. ❌ **确认无恐怖谷效应section**
   - 不应出现语义差异量表
   - 不应出现"舒适的↔诡异的"等题目

---

### 4. **数据验证**

提交问卷后，在浏览器Console中查看：

```javascript
// 任务4应该包含以下section
提交问卷数据: {
  task_id: 4,
  responses: {
    manipulation_check: {...},  // 5题
    ios_closeness: {...},       // 1题
    closeness: {...},           // 4题
    mind_perception: {...},     // ✅ 4题（新增）
    trust: {...},               // ✅ 7题（新增）
    satisfaction: {...},        // 4题
    privacy_concern: {...},     // 5题（精简）
    open_ended: {...}           // 1题（精简）
  }
}
```

在后端数据库中检查：
```bash
sqlite3 data/experiment.db

-- 检查任务4问卷数据
SELECT questionnaire_data FROM user_tasks WHERE task_id = 4;

-- 应包含 mind_perception 和 trust，不应包含 uncanny_valley
```

---

## 📝 量表信度参考（方案B更新）

| 量表 | 题数 | α范围 | 来源 | 说明 |
|------|------|-------|------|------|
| **心智感知** | **4** | **.78-.82** | Gray et al. (2007) | 精简版，保留核心维度 |
| IOS量表 | 1视觉 | .89 | Aron et al. (1992) | 单题视觉量表 |
| 操纵检验 | 5 | 待验证 | Kalyanaraman & Sundar (2006) | 改编自感知个性化量表 |
| 信任 | 7 | .85-.87 | AAAI 2024 | 双维度（认知+情感）|
| 自我披露 | 5 | .92 | Wheeless & Grotz (1976) | 深度+诚实维度 |
| 满意度 | 4 | 待验证 | Cheng & Jiang (2020) | 综合满意度 |
| 持续使用意愿 | 4 | .91 | Ashfaq et al. | - |
| 社会临场感 | 4 | 待验证 | ASP量表改编 | - |
| **隐私担忧** | **5** | **.80-.85** | IUIPC精简版 | 删除"意识"维度 |
| ~~恐怖谷效应~~ | ~~5~~ | ~~.86~~ | ~~Ho & MacDorman (2017)~~ | **已删除** |

**方案B信度说明**：
- 4题心智感知：Cortina (1993)研究表明4题量表可达 α = .75-.80
- 5题隐私担忧：IUIPC原研究"收集"维度单独 α = .86，"控制"维度 α = .85

---

## 📈 数据分析计划

### **1. 纵向分析（方案B核心）**

#### **心智感知变化分析**

```python
# 混合方差分析 (Mixed ANOVA)
import pandas as pd
from statsmodels.stats.anova import AnovaRM

# 数据准备
# subject | memory_group | time | mind_perception_score
data = pd.DataFrame({
    'subject': [1, 1, 2, 2, ...],
    'memory_group': ['L1', 'L1', 'L2', 'L2', ...],
    'time': ['T1', 'T4', 'T1', 'T4', ...],
    'mind_perception': [12, 13, 14, 17, ...]  # 满分20
})

# 重复测量方差分析
model = AnovaRM(data, 'mind_perception', 'subject',
                within=['time'],
                between=['memory_group'])
result = model.fit()

# 期望结果：
# - 时间主效应: F(1, 96) > 4.0, p < .05
# - 组别主效应: F(3, 96) > 6.0, p < .001
# - 交互作用: F(3, 96) > 3.0, p < .05 (L4组提升最大)
```

#### **信任增长曲线分析**

```python
# 增长曲线模型 (Growth Curve Model)
import pymer4

# 3个时间点: T1(基线) → T3(中期) → T4(终点)
model = pymer4.Lmer(
    'trust_score ~ time * memory_group + (time | subject)',
    data=df
)

# 期望结果：
# L4组斜率: β = 0.8-1.2 (增长最快)
# L1组斜率: β = -0.1-0.2 (停滞或下降)
```

---

### **2. 操纵检验验证**

```python
# 单因素方差分析
from scipy.stats import f_oneway

# 任务2的操纵检验得分
f_stat, p_value = f_oneway(
    manipulation_check_L1,  # 期望: M = 10-15 (低)
    manipulation_check_L2,  # 期望: M = 18-22 (中)
    manipulation_check_L3,  # 期望: M = 23-27 (中高)
    manipulation_check_L4   # 期望: M = 28-35 (高)
)

# 期望: F > 10.0, p < .001, η² > 0.14 (大效应)
```

---

### **3. 中介效应分析**

```python
# PROCESS Macro Model 4
# 记忆水平 → 感知记忆能力 → 信任 → 持续使用意愿

from process import Process

model = Process(data=df, model=4,
                x='memory_level',
                m=['manipulation_check', 'trust'],
                y='continuance_intention')

# 预期路径系数：
# a1路径(记忆→感知): β = 0.6-0.8, p < .001
# a2路径(感知→信任): β = 0.4-0.6, p < .001
# b路径(信任→意愿): β = 0.5-0.7, p < .001
```

---

## ⚠️ 注意事项

### **1. 操纵检验时机**
- 任务1：❌ 无（记忆差异不明显）
- 任务2：✅ **必须**（首次记忆触发，验证操纵成功）
- 任务3：✅ 建议（持续性验证）
- 任务4：✅ 建议（最终验证，检查衰减）

### **2. 纵向测量一致性**
- 心智感知：T1和T4题目**完全相同**
- 信任：T1、T3、T4题目**完全相同**
- IOS量表：T1、T2、T4呈现方式**完全相同**

### **3. 数据完整性**
- 所有select默认选中中间值
- IOS量表默认选中4分（中间值）
- 开放题可以为空（但鼓励填写）

### **4. 浏览器兼容性**
- 推荐Chrome/Edge/Firefox最新版
- Safari需要13+版本
- 移动端已优化（响应式设计）

### **5. 性能考虑**
- 问卷动态生成，不影响页面加载速度
- 数据收集使用原生JS，无额外依赖
- SVG圆圈渲染性能优秀

---

## 🔧 自定义配置

如需修改问卷内容，编辑 `static/questionnaire_config.js`：

### **修改现有题目**

```javascript
// 任务1 - 心智感知
{
    id: 'mind_perception',
    questions: [
        { id: 'q1', text: '这个AI似乎有它自己的意图', subtitle: '施动性' },
        // 修改文本但保持ID不变（确保数据一致性）
    ]
}
```

### **添加新题目**

```javascript
// 在某个section的questions数组中添加
{ id: 'q5', text: '新问题', subtitle: '可选分组' }
```

### **修改量表类型**

```javascript
scale: '5point'  // 5点Likert量表
scale: '7point'  // 7点Likert量表
scale: 'semantic_differential'  // 语义差异量表（-3到+3）
```

### **添加subtitle用于分组**

```javascript
{ id: 'q1', text: '问题1', subtitle: '认知维度' }
{ id: 'q2', text: '问题2', subtitle: '情感维度' }
```

---

## 📚 相关文档

1. **理论依据**：`data/文献综述_因变量量表推荐.md`
   - 包含所有量表的理论来源
   - 操纵检验的测量时机说明

2. **配置文件**：`static/questionnaire_config.js`
   - 400+行完整配置
   - 4个任务的所有量表定义

3. **前端实现**：`static/index.html` (行2452-2709)
   - 动态渲染逻辑
   - 数据收集函数

4. **方案B详细说明**：`方案B实施总结.md`
   - 修改理由和理论依据
   - 预期研究成果
   - 统计分析计划

---

## 🎓 方案B的学术价值

### **创新点**

1. **首次在AI记忆实验中实现心智感知的纵向测量**
   - 填补文献空白
   - 探索记忆→心智感知的因果机制

2. **完整追踪信任建立轨迹**
   - T1(基线) → T3(发展) → T4(稳定)
   - 可绘制增长曲线

3. **基于实证证据优化测量**
   - 删除不适用维度（恐怖谷）
   - 精简冗余题目
   - 保持核心测量完整性

### **预期发表**

**论文1：主效应研究**
- 投稿：*CHI* 或 *Human-Computer Interaction*
- 贡献：四级记忆架构对人机关系的影响

**论文2：纵向机制研究** ⭐ (方案B独有)
- 投稿：*Computers in Human Behavior*
- 贡献：记忆能力如何塑造心智感知和信任

**论文3：量表验证研究**
- 投稿：*Behavior Research Methods*
- 贡献：心智感知4题精简版的跨文化验证

---

## 📊 方案B vs 原方案对比

| 指标 | 原方案 | 方案B | 优势 |
|------|--------|-------|------|
| 总题数 | 100题 | **97题** | -3% 减轻负担 ✅ |
| 任务1题数 | 26题 | **24题** | -2题 ✅ |
| 任务4题数 | 25题 | **24题** | -1题 ✅ |
| 纵向变量数 | 3个 | **5个** | +67% 分析能力 ⭐ |
| 心智感知测量点 | 1个 | **2个** | +100% ⭐ |
| 信任测量点 | 2个 | **3个** | +50% ⭐ |
| 问卷总时长 | 21分钟 | **20分钟** | -5% ✅ |
| 论文发表潜力 | 2篇 | **3篇** | +50% ⭐ |

---

**实现时间**: 2026-02-03
**版本**: v2.0 (方案B)
**状态**: ✅ 已完成并测试
**下一步**: 预试验（N=10）验证信度
